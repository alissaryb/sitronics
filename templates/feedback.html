{% extends 'base.html' %}
{% block main_content %}

  <style>
        body {
            color: #ffffff; /* Белый цвет текста по умолчанию */
        }

        .course-details {
            background-color: #1e1e1e; /* Темный фон для блока с информацией */
            border: 1px solid #444; /* Умеренный цвет границы */
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .course-details p {
            color: #ffffff; /* Белый цвет текста в блоке с информацией */
        }

        h2, h5 {
            color: #a070ff; /* Цвет заголовков */
        }
    </style>

    <div class="container mt-5">
        <h1 class="mb-4">Отзывы пользователей</h1>

        <!-- Полоса с рейтингом -->
        <div class="rating-bar">
            <h5>Рейтинг</h5>
            {% set total_score = (ratings[0] * 1 + ratings[1] * 2 + ratings[2] * 3 + ratings[3] * 4 + ratings[4] * 5) %}
            {% set total_reviews = ratings | sum %}
            {% set average_rating = (total_score / total_reviews) if total_reviews > 0 else 0 %}
            <div class="average-rating">
                <span>{{ average_rating | round(1) }}</span>
            </div>
            {% for i in range(5) %}
            <div class="progress-container">
                <span>{{ 5 - i }} звёзд ({{ ratings[4 - i] }})</span>
                <div class="progress">
                    <div class="progress-bar {{ ['bg-secondary', 'bg-danger', 'bg-warning', 'bg-info', 'bg-success'][i] }}" role="progressbar" style="width: {{ (ratings[4 - i] / total_reviews * 100) }}%;" aria-valuenow="{{ ratings[4 - i] }}" aria-valuemin="0" aria-valuemax="{{ total_reviews }}"></div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Форма для создания отзыва -->
        <h5>Создать свой отзыв</h5>
        <div class="mb-3">
            <label class="form-label">Выберите количество звёзд:</label>
            <div id="starRating" class="d-flex">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
        </div>
        <div class="mb-3">
            <label for="reviewText" class="form-label">Ваш отзыв:</label>
            <textarea class="form-control" id="reviewText" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary" id="submitReview">Отправить отзыв</button>


        <!-- Примеры отзывов -->
        <h5 class="mt-4">Примеры отзывов</h5>
        <div class="review-example">
            <strong>Отлично!</strong>
            <p>5 звёзд - Приложение просто супер! Все функции работают отлично, рекомендую всем!</p>
        </div>
        <div class="review-example">
            <strong>Хорошо, но есть недочёты</strong>
            <p>4 звезды - Приложение хорошее, но иногда бывают сбои. Надеюсь, что это исправят.</p>
        </div>
        <div class="review-example">
            <strong>Нормально</strong>
            <p>3 звезды - Приложение среднее, есть как плюсы, так и минусы.</p>
        </div>
        <div class="review-example">
            <strong>Неудовлетворительно</strong>
            <p>2 звезды - Приложение не оправдало ожиданий, много ошибок.</p>
        </div>
        <div class="review-example">
            <strong>Ужасно</strong>
            <p>1 звезда - Полное разочарование. Не рекомендую это приложение!</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const stars = document.querySelectorAll('.star');
        let selectedRating = 0;

        stars.forEach(star => {
            star.addEventListener('click', function() {
                selectedRating = this.getAttribute('data-value');
                updateStarSelection(selectedRating);
            });
        });

        function updateStarSelection(rating) {
            stars.forEach(star => {
                star.classList.remove('selected');
                if (star.getAttribute('data-value') <= rating) {
                    star.classList.add('selected');
                }
            });
        }

        document.getElementById('submitReview').addEventListener('click', function(event) {
            event.preventDefault();
            const reviewText = document.getElementById('reviewText').value;

            if (selectedRating > 0 && reviewText) {
                console.log(`Звезды: ${selectedRating}, Отзыв: ${reviewText}`);
                alert('Ваш отзыв успешно отправлен!');
                // Очистка формы
                updateStarSelection(0);
                document.getElementById('reviewText').value = '';
            } else {
                alert('Пожалуйста, выберите количество звёзд и введите текст отзыва.');
            }
        });
    </script>
{% endblock %}